---
import Section from "@/components/Section";
import { Picture } from "astro:assets";
import { getCollection } from "astro:content";
import Lightbox from "../Lightbox";
import Link from "../Link";

const lang = Astro.props.lang || "en";

const langProjects = await getCollection(
  "projects",
  ({ slug, data }) => slug.startsWith(`${lang}/`) && data.year,
);

const latestProjects = langProjects.sort(
  (a, b) => new Date(b.data.year).getTime() - new Date(a.data.year).getTime(),
);
---

<Section
  client:visible
  className="h-fit w-full space-y-4 pt-4 portrait:z-20 landscape:z-20"
>
  {
    latestProjects.length > 0 ? (
      <div class="grid grid-cols-1 items-center justify-evenly gap-4 tablet:grid-cols-2 laptop:grid-cols-3">
        {latestProjects.map((entry) => (
          <div class="my-2 flex h-full w-full flex-col items-center justify-start gap-2 rounded-md border-2 border-zinc-100/20 p-2 dark:border-zinc-900/20">
            {entry.data.headerImage && (
              <div class="relative mx-auto h-[200px] w-full items-center justify-center overflow-hidden rounded-md transition-transform duration-200 ease-in-out hover:rotate-1 hover:scale-110">
                <Lightbox client:load>
                  <Picture
                    formats={["avif", "webp"]}
                    src={entry.data.headerImage.src}
                    alt={entry.data.headerImage.alt}
                    width={1200}
                    height={630}
                    class="pointer-events-none my-auto rounded-md"
                  />
                </Lightbox>
              </div>
            )}
            <div class="flex flex-1 flex-col items-center justify-between py-2">
              <div class="flex flex-col items-center justify-center gap-1">
                <span class="text-sm">{entry.data.year}</span>
                <h3 class="text-2xl font-semibold">{entry.data.name}</h3>
              </div>
              <p class="text-center">{entry.data.description}</p>
              <Link
                client:load
                href={`projects/${entry.slug.split("/")[1]}`}
                className="uppercase text-xl border rounded-md p-2 border-transparent hover:border-primary-300 dark:hover:border-primary-700 transition-colors duration-200"
              >
                Explore
              </Link>
            </div>
          </div>
        ))}
      </div>
    ) : (
      <div class="flex h-[200px]">
        <h6 class="m-auto text-center text-xl">No blog entries found</h6>
      </div>
    )
  }
</Section>
